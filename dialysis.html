<!doctype html>  
<html lang="zh-Hant">  
<head>  
  <meta charset="utf-8">  
  <script src="https://cdn.tailwindcss.com"></script>  
  <title>透析排程系統</title>  
</head>  
<body class="p-4">  
<script>  
const BASE = 'https://script.google.com/macros/s/AKfycbxxjuSksplIKKLrV0KJGiVgO1i9-iWNkz6rHQr1lJLtE0ucAS1fiD_L7LNEzG_92-Fcqg/exec';          // ← 換成 Apps Script URL  
const FREQ_MAP = {  
  '一三五':['Mon','Wed','Fri'],  
  '二四六':['Tue','Thu','Sat'],  
  '一四':['Mon','Thu'],  
  '二五':['Tue','Fri'],  
  '三六':['Wed','Sat'],  
  '每周一次':['Mon'],  
  '臨時':[]  
};  
const MODES = ['HD','SLED','CVVHDF','PP','DFPP'];  
</script>  

<!-- Tab Buttons -->  
<div class="mb-4 flex gap-2">  
  <button onclick="showTab(1)" class="btn">住院名單</button>  
  <button onclick="showTab(2)" class="btn">門診排程</button>  
  <button onclick="showTab(3)" class="btn">綜合排程</button>  
  <button onclick="showTab(4)" class="btn">今日名單</button>  
</div>  

<!-- (1) 住院名單 -->  
<div id="tab-1" hidden>  
  <h2 class="font-bold">住院洗腎病人</h2>  
  <button class="btn" onclick="openInForm()">新增</button>  
  <table id="in-table" class="table-auto w-full mt-2 border"></table>  
</div>  

<!-- (2) 門診排程 -->  
<div id="tab-2" hidden>  
  <h2 class="font-bold">門診 50 床排程</h2>  
  <div id="out-sched" class="overflow-auto"></div>  
</div>  

<!-- (3) 綜合排程 -->  
<div id="tab-3" hidden>  
  <h2 class="font-bold">綜合排程</h2>  
  <div class="flex gap-4">  
    <div class="grow" id="bed-grid"></div>  
    <div class="w-60">  
      <h3 class="font-semibold">住院名單</h3>  
      <ul id="in-list" class="space-y-1"></ul>  
    </div>  
  </div>  
</div>  

<!-- (4) 今日名單 -->  
<div id="tab-4" hidden>  
  <h2 class="font-bold">當日透析</h2>  
  <div id="today-grid"></div>  
</div>  

<!-- ========= 模態框（快速示意） ========= -->  
<div id="modal" hidden class="fixed inset-0 bg-black/40 flex items-center justify-center">  
  <div class="bg-white p-4 rounded w-80">  
    <h3 class="font-bold mb-2">編輯</h3>  
    <div id="modal-body"></div>  
    <div class="text-right mt-2">  
      <button class="btn" onclick="closeModal()">取消</button>  
      <button id="modal-save" class="btn bg-blue-500 text-white">儲存</button>  
    </div>  
  </div>  
</div>  

<style>  
.btn{ @apply px-3 py-1 border rounded hover:bg-gray-200;}  
td,th{ @apply border px-1 text-center;}  
.bed-empty{ @apply bg-white;}  
.bed-out{  @apply bg-green-200;}  
.bed-in{   @apply bg-blue-200;}  
.bed-orange{@apply bg-orange-200;}  
</style>  

<script>  
// === 共用工具 ===  
function showTab(n){[1,2,3,4].forEach(i=>$('#tab-'+i).hidden=i!==n); if(n===1)loadIn(); if(n===2)loadOut(); if(n===3)loadBed(); if(n===4)showToday();}  
const $=q=>document.querySelector(q);  
async function api(table,action,data){  
  const method = data?'POST':'GET';  
  const url = BASE + `?table=${table}&action=${action}`;  
  const opt = data?{method,body:JSON.stringify(data),muteHttpExceptions:true}:{method};  
  return fetch(url,opt).then(r=>r.json());  
}  

// === (1) 住院名單 ===  
async function loadIn(){  
  const rows = await api('in','list');  
  const t=$('#in-table'); t.innerHTML='';  
  t.insertAdjacentHTML('beforeend',`<tr>${['姓名','MRN','醫師','頻率','模式',''].map(h=>`<th>${h}</th>`).join('')}</tr>`);  
  rows.forEach(r=>{  
    const tr=document.createElement('tr');  
    tr.innerHTML=`<td>${r.name}</td><td>${r.mrn}</td><td>${r.doctor}</td><td>${r.freq}</td><td>${r.mode}</td>  
      <td><button class="btn" onclick="editIn('${r.id}')">編輯</button></td>`;  
    t.appendChild(tr);  
  });  
}  
function openInForm(obj={}){  
  $('#modal').hidden=false;  
  $('#modal-body').innerHTML=`  
    ${['name','mrn','doctor'].map(k=>`<label>${k}<input id="f-${k}" class="border w-full" value="${obj[k]||''}"/></label>`).join('')}  
    <label>頻率<select id="f-freq" class="border w-full">${Object.keys(FREQ_MAP).map(o=>`<option ${o===obj.freq?'selected':''}>${o}</option>`).join('')}</select></label>  
    <label>模式<select id="f-mode" class="border w-full">${MODES.map(m=>`<option ${m===obj.mode?'selected':''}>${m}</option>`).join('')}</select></label>`;  
  $('#modal-save').onclick=async()=>{  
    const d={id:obj.id,name:$('#f-name').value,mrn:$('#f-mrn').value,doctor:$('#f-doctor').value,freq:$('#f-freq').value,mode:$('#f-mode').value};  
    if(obj.id) await api('in','update',d); else await api('in','add',d);  
    closeModal(); loadIn();  
  };  
}  
function editIn(id){ api('in','list').then(l=>openInForm(l.find(r=>r.id===id))); }  
function closeModal(){ $('#modal').hidden=true; }  

// 其餘 (2)(3)(4) 介面：演算法類似，示意略。  
</script>  
</body>  
</html>